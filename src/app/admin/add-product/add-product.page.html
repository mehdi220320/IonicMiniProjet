<!-- Side Menu -->
<ion-menu contentId="main-content" type="overlay">
  <ion-header>
    <ion-toolbar color="primary">
      <ion-title>Admin Panel</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-content>
    <div class="admin-profile">
      <div class="avatar-container">
        <ion-avatar>
          <ion-icon name="shield-checkmark" class="avatar-icon"></ion-icon>
        </ion-avatar>
      </div>
      <h2 class="admin-name">{{ admin?.username || 'Admin' }}</h2>
      <p class="admin-email">{{ admin?.email || 'admin@marketplace.com' }}</p>
      <ion-badge color="warning" class="admin-role">
        <ion-icon name="star" slot="start"></ion-icon>
        ADMINISTRATOR
      </ion-badge>
    </div>

    <ion-list class="menu-list">
      <ion-item button detail="false" lines="none" (click)="navigateTo('dashboard')" [class.active]="currentPage === 'dashboard'">
        <ion-icon name="grid-outline" slot="start"></ion-icon>
        <ion-label>Dashboard</ion-label>
      </ion-item>

      <ion-item button detail="false" lines="none" (click)="navigateTo('add-product')" [class.active]="currentPage === 'add-product'">
        <ion-icon name="add-circle-outline" slot="start"></ion-icon>
        <ion-label>Add Product</ion-label>
      </ion-item>

      <ion-item button detail="false" lines="none" (click)="navigateTo('add-category')" [class.active]="currentPage === 'add-category'">
        <ion-icon name="pricetags-outline" slot="start"></ion-icon>
        <ion-label>Add Category</ion-label>
      </ion-item>

      <ion-item button detail="false" lines="none" (click)="navigateTo('users')" [class.active]="currentPage === 'users'">
        <ion-icon name="people-outline" slot="start"></ion-icon>
        <ion-label>All Users</ion-label>
      </ion-item>

      <ion-item button detail="false" lines="none" (click)="navigateTo('orders')" [class.active]="currentPage === 'orders'">
        <ion-icon name="receipt-outline" slot="start"></ion-icon>
        <ion-label>Orders Management</ion-label>
      </ion-item>

      <ion-item button detail="false" lines="none" (click)="navigateTo('settings')" [class.active]="currentPage === 'settings'">
        <ion-icon name="settings-outline" slot="start"></ion-icon>
        <ion-label>Settings</ion-label>
      </ion-item>
    </ion-list>

    <div class="menu-footer">
      <ion-menu-toggle>
        <ion-button expand="block" color="danger" (click)="logout()">
          <ion-icon name="log-out-outline" slot="start"></ion-icon>
          Logout
        </ion-button>
      </ion-menu-toggle>
    </div>
  </ion-content>
</ion-menu>

<!-- Main Content -->
<div class="ion-page" id="main-content">
  <ion-header>
    <ion-toolbar color="primary">
      <ion-buttons slot="start">
        <ion-menu-button auto-hide="false"></ion-menu-button>
      </ion-buttons>
      <ion-title>Add Product</ion-title>
      <ion-buttons slot="end">
        <ion-button (click)="navigateTo('dashboard')">
          <ion-icon name="home-outline"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content [fullscreen]="true">
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-icon">
        <ion-icon name="cube"></ion-icon>
      </div>
      <h1>Create New Product</h1>
      <p>Add a new product to your marketplace inventory</p>
    </div>

    <!-- Product Form -->
    <div class="form-container">
      <ion-card class="form-card">
        <ion-card-content>
          <form #productForm="ngForm" (ngSubmit)="onSubmit()">

            <!-- Product Image -->
            <div class="form-group">
              <ion-label class="form-label">
                Product Image <span class="required">*</span>
              </ion-label>
              <p class="form-hint">Upload a high-quality product image</p>

              <div class="image-upload-section">
                <div class="image-preview" *ngIf="product.imageUri; else noImage">
                  <img [src]="product.imageUri" alt="Product preview">
                  <ion-button
                    class="remove-image-btn"
                    fill="clear"
                    color="danger"
                    (click)="removeImage()">
                    <ion-icon name="close-circle" slot="icon-only"></ion-icon>
                  </ion-button>
                </div>

                <ng-template #noImage>
                  <div class="no-image">
                    <ion-icon name="image-outline"></ion-icon>
                    <p>No image selected</p>
                  </div>
                </ng-template>

                <div class="upload-buttons">
                  <ion-button expand="block" (click)="takePicture()" [disabled]="isSubmitting">
                    <ion-icon name="camera-outline" slot="start"></ion-icon>
                    Take Photo
                  </ion-button>
                  <ion-button expand="block" fill="outline" (click)="pickFromGallery()" [disabled]="isSubmitting">
                    <ion-icon name="images-outline" slot="start"></ion-icon>
                    Choose from Gallery
                  </ion-button>
                </div>
              </div>

              <div class="error-message" *ngIf="productForm.submitted && !product.imageUri">
                <ion-icon name="alert-circle"></ion-icon>
                <span>Product image is required</span>
              </div>
            </div>

            <!-- Product Name -->
            <div class="form-group">
              <ion-label class="form-label">
                Product Name <span class="required">*</span>
              </ion-label>
              <ion-input
                type="text"
                [(ngModel)]="product.name"
                name="name"
                placeholder="e.g., Wireless Headphones Pro"
                required
                class="custom-input"
                [class.error]="productForm.submitted && !product.name">
              </ion-input>
              <div class="error-message" *ngIf="productForm.submitted && !product.name">
                <ion-icon name="alert-circle"></ion-icon>
                <span>Product name is required</span>
              </div>
            </div>

            <!-- Product Description -->
            <div class="form-group">
              <ion-label class="form-label">
                Description <span class="required">*</span>
              </ion-label>
              <ion-textarea
                [(ngModel)]="product.description"
                name="description"
                placeholder="Enter a detailed description of the product..."
                rows="5"
                required
                class="custom-textarea"
                [class.error]="productForm.submitted && !product.description">
              </ion-textarea>
              <div class="error-message" *ngIf="productForm.submitted && !product.description">
                <ion-icon name="alert-circle"></ion-icon>
                <span>Description is required</span>
              </div>
            </div>

            <!-- Product Price -->
            <div class="form-group">
              <ion-label class="form-label">
                Price (USD) <span class="required">*</span>
              </ion-label>
              <div class="price-input-wrapper">
                <span class="currency-symbol">$</span>
                <ion-input
                  type="number"
                  [(ngModel)]="product.price"
                  name="price"
                  placeholder="0.00"
                  min="0"
                  step="0.01"
                  required
                  class="custom-input price-input"
                  [class.error]="productForm.submitted && (!product.price || product.price <= 0)">
                </ion-input>
              </div>
              <div class="error-message" *ngIf="productForm.submitted && (!product.price || product.price <= 0)">
                <ion-icon name="alert-circle"></ion-icon>
                <span>Valid price is required</span>
              </div>
            </div>

            <!-- Category Selection -->
            <div class="form-group">
              <ion-label class="form-label">
                Category <span class="required">*</span>
              </ion-label>
              <p class="form-hint">Select the category for this product</p>

              <ion-select
                [(ngModel)]="selectedCategoryId"
                name="category"
                placeholder="Choose a category"
                interface="action-sheet"
                class="custom-select"
                [class.error]="productForm.submitted && !selectedCategoryId"
                (ionChange)="onCategoryChange()">
                <ion-select-option *ngFor="let cat of categories" [value]="cat.id">
                  {{ cat.name }}
                </ion-select-option>
              </ion-select>

              <!-- Category Preview -->
              <div class="category-preview" *ngIf="product.category">
                <ion-chip color="primary">
                  <ion-icon [name]="product.category.icon"></ion-icon>
                  <ion-label>{{ product.category.name }}</ion-label>
                </ion-chip>
              </div>

              <div class="error-message" *ngIf="productForm.submitted && !selectedCategoryId">
                <ion-icon name="alert-circle"></ion-icon>
                <span>Please select a category</span>
              </div>
            </div>

            <!-- Product Preview -->
            <div class="form-group preview-section" *ngIf="product.name || product.imageUri || product.price">
              <ion-label class="form-label">Product Preview</ion-label>
              <ion-card class="product-preview-card">
                <div class="preview-image" *ngIf="product.imageUri">
                  <img [src]="product.imageUri" alt="Preview">
                </div>
                <ion-card-content>
                  <h4>{{ product.name || 'Product Name' }}</h4>
                  <p class="preview-description" *ngIf="product.description">
                    {{ product.description }}
                  </p>
                  <div class="preview-footer">
                    <span class="preview-price">{{ product.price ? '$' + product.price.toFixed(2) : '$0.00' }}</span>
                    <ion-chip *ngIf="product.category" color="primary" class="preview-category">
                      <ion-icon [name]="product.category.icon"></ion-icon>
                      <ion-label>{{ product.category.name }}</ion-label>
                    </ion-chip>
                  </div>
                </ion-card-content>
              </ion-card>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
              <ion-button
                expand="block"
                type="submit"
                [disabled]="isSubmitting"
                class="submit-btn">
                <ion-icon name="checkmark-circle" slot="start"></ion-icon>
                {{ isSubmitting ? 'Creating...' : editingProductId ? 'Update Product' : 'Create Product' }}
              </ion-button>

              <ion-button
                expand="block"
                fill="outline"
                color="medium"
                (click)="resetForm()"
                [disabled]="isSubmitting"
                class="reset-btn">
                <ion-icon name="refresh" slot="start"></ion-icon>
                Reset Form
              </ion-button>
            </div>
          </form>
        </ion-card-content>
      </ion-card>

      <!-- Existing Products -->
      <ion-card class="products-list-card">
        <ion-card-header>
          <div class="card-header-content">
            <ion-card-title>All Products</ion-card-title>
            <ion-badge color="primary">{{ products.length }}</ion-badge>
          </div>
        </ion-card-header>
        <ion-card-content>
          <div class="products-grid" *ngIf="products.length > 0; else noProducts">
            <div *ngFor="let prod of products" class="product-item">
              <div class="product-image">
                <img [src]="prod.imageUri" [alt]="prod.name">
              </div>
              <div class="product-details">
                <h4>{{ prod.name }}</h4>
                <p class="product-price">${{ prod.price.toFixed(2) }}</p>
                <ion-chip *ngIf="prod.category" color="primary" size="small">
                  <ion-icon [name]="prod.category.icon"></ion-icon>
                  <ion-label>{{ prod.category.name }}</ion-label>
                </ion-chip>
              </div>
              <div class="product-actions">
                <ion-button fill="clear" size="small" (click)="editProduct(prod)">
                  <ion-icon name="create-outline" slot="icon-only"></ion-icon>
                </ion-button>
                <ion-button fill="clear" size="small" color="danger" (click)="deleteProduct(prod)">
                  <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
                </ion-button>
              </div>
            </div>
          </div>

          <ng-template #noProducts>
            <div class="empty-state">
              <ion-icon name="cube-outline"></ion-icon>
              <p>No products yet</p>
              <span>Create your first product above</span>
            </div>
          </ng-template>
        </ion-card-content>
      </ion-card>
    </div>
  </ion-content>

  <!-- Footer Navigation -->
  <ion-footer>
    <ion-toolbar>
      <div class="footer-nav">
        <ion-button class="footer-btn" (click)="navigateTo('dashboard')">
          <ion-icon name="grid-outline"></ion-icon>
          <span>Dashboard</span>
        </ion-button>
        <ion-button class="footer-btn active" (click)="navigateTo('products')">
          <ion-icon name="cube-outline"></ion-icon>
          <span>Products</span>
        </ion-button>
        <ion-button class="footer-btn" (click)="navigateTo('categories')">
          <ion-icon name="pricetags-outline"></ion-icon>
          <span>Categories</span>
        </ion-button>
      </div>
    </ion-toolbar>
  </ion-footer>
</div>
